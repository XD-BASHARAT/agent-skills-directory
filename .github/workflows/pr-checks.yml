name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-validation:
    name: PR Validation
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Bun
        uses: oven-sh/setup-bun@3d267786b128fe76c2f16a390aa2448b815359f3 # v2.1.2
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install --frozen-lockfile

      - name: Check for console.log statements
        run: |
          if git diff origin/${{ github.base_ref }}...HEAD -- '*.ts' '*.tsx' | grep -E '^\+.*console\.(log|debug|info)'; then
            echo "‚ùå Found console.log statements in the changes"
            echo "Please remove console.log statements before merging"
            exit 1
          else
            echo "‚úÖ No console.log statements found"
          fi

      - name: Check file naming conventions
        run: |
          # Check for kebab-case in component files
          if find app components features -name "*.tsx" -o -name "*.ts" | grep -E '[A-Z]'; then
            echo "‚ö†Ô∏è Warning: Some files use PascalCase. Consider using kebab-case for consistency"
          fi

      - name: Lint changed files
        run: bun lint

      - name: Type check
        run: bunx tsc --noEmit

  size-check:
    name: Bundle Size Check
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install --frozen-lockfile

      - name: Build
        run: bun run build
        env:
          SKIP_ENV_VALIDATION: true

      - name: Analyze bundle
        run: |
          echo "üì¶ Build completed successfully"
          du -sh .next
